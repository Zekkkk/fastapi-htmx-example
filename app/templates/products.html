{% from "components/dialog.html" import dialog %}

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Products</title>

  <!-- HTMX -->
  <script src="https://unpkg.com/htmx.org@1.9.10"></script>

  <!-- Basecoat CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/basecoat-css@0.3.9/dist/basecoat.cdn.min.css">
  <script src="https://cdn.jsdelivr.net/npm/basecoat-css@0.3.9/dist/js/all.min.js" defer></script>
</head>

<body>

  <h1>Products</h1>

  <h2>Create product</h2>

  {% call dialog(
  id="dialog-add-product",
  trigger='<span class="btn-outline">Add Product</span>',
  title="Create New Product",
  description="Fill out the form below to create a product.",
  footer='<button class="btn" type="submit" form="product-form">Create</button>',
  dialog_attrs={"class": "w-full sm:max-w-[425px] max-h-[612px]"},
  body_attrs={"class": "p-4"}
) %}
  {% include "product_form.html" %}
{% endcall %}


  <hr>

  <!-- Button to load products -->
  <button
    class="btn"
    hx-get="/products-table"
    hx-target="#products-body"
    hx-swap="innerHTML"
    hx-trigger="click"
  >
    Load Products
  </button>

  <br><br>

  <!-- Products table -->
  <table class="table" border="1" cellpadding="8">
    <thead>
      <tr>
        <th>Name</th>
        <th>Price</th>
        <th>In stock</th>
        <th>Actions</th>
      </tr>
    </thead>

    <tbody id="products-body">
      {% for product in products %}
      <tr>
        <td>{{ product.name }}</td>
        <td>{{ product.price }}</td>
        <td>
          {% if product.in_stock %}
            in stock
          {% else %}
            out of stock
          {% endif %}
        </td>
        <td>
          <!-- Valid HTMX attributes (no # comments inside attributes) -->
          <button
            class="btn"
            hx-delete="/products/{{ product.name }}"
            hx-confirm="Are you sure?"
            hx-target="closest tr"
            hx-swap="delete"
          >
            Delete
          </button>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

</body>
</html>
